# LettersInTime Dockerfile
# ç”¨äºŽä»£ç æŒ‚è½½éƒ¨ç½²ï¼šä»£ç åœ¨å®¿ä¸»æœºï¼Œå®¹å™¨å†…ç¼–è¯‘è¿è¡Œ
# 
# ç‰¹ç‚¹ï¼š
# - å®¿ä¸»æœºé€šè¿‡ Git ç®¡ç†ä»£ç 
# - å®¹å™¨æä¾›ç¼–è¯‘å’Œè¿è¡ŒçŽ¯å¢ƒ
# - Maven ä¾èµ–ç¼“å­˜åŠ é€Ÿæž„å»º

FROM maven:3.8-openjdk-11

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£… curl ç”¨äºŽå¥åº·æ£€æŸ¥
RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

# æš´éœ²åº”ç”¨ç«¯å£
EXPOSE 8080

# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai

# åˆ›å»ºå¯åŠ¨è„šæœ¬
RUN echo '#!/bin/bash\n\
set -e\n\
echo "================================="\n\
echo "  LettersInTime Container Started"\n\
echo "================================="\n\
echo ""\n\
echo "ðŸ“‚ æ£€æŸ¥ä»£ç ç›®å½•..."\n\
if [ ! -f "pom.xml" ]; then\n\
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ° pom.xml æ–‡ä»¶"\n\
    echo "è¯·ç¡®ä¿é¡¹ç›®ä»£ç å·²æŒ‚è½½åˆ° /app ç›®å½•"\n\
    exit 1\n\
fi\n\
echo "âœ… ä»£ç ç›®å½•æ£€æŸ¥é€šè¿‡"\n\
echo ""\n\
echo "ðŸ“¦ å¼€å§‹ Maven æž„å»º..."\n\
mvn clean package -DskipTests -B\n\
echo ""\n\
echo "âœ… æž„å»ºå®Œæˆ"\n\
echo ""\n\
echo "ðŸš€ å¯åŠ¨åº”ç”¨..."\n\
java -Xms256m -Xmx512m -Djava.security.egd=file:/dev/./urandom -jar target/*.jar\n\
' > /entrypoint.sh && chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]

